<!doctype html>



  


<html class="theme-next mist use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="一个正在填坑的front-ender">
<meta property="og:type" content="website">
<meta property="og:title" content="董方园网络blog">
<meta property="og:url" content="http://ycomer.com/page/5/index.html">
<meta property="og:site_name" content="董方园网络blog">
<meta property="og:description" content="一个正在填坑的front-ender">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="董方园网络blog">
<meta name="twitter:description" content="一个正在填坑的front-ender">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '6360603109923751000',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://ycomer.com/page/5/"/>





  <title> 董方园网络blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta custom-logo">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">董方园网络blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">编程、技术、生活、旅行</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://ycomer.com/2017/09/02/Node-js专题之构建web应用/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="浪子膏">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="董方园网络blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="董方园网络blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/02/Node-js专题之构建web应用/" itemprop="url">
                  Node.js专题之构建web应用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-01T23:56:00Z">
                2017-09-01
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          
             <span id="/2017/09/02/Node-js专题之构建web应用/" class="leancloud_visitors" data-flag-title="Node.js专题之构建web应用">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="中间件"><a href="#中间件" class="headerlink" title="中间件"></a>中间件</h1><p>中间件使用来简化和隔离基础设施和业务逻辑之间的细节。在基础设施对于具体的业务逻辑没有支持的情况下，必须有开发框架来对业务提供支持，通过中间件的形式搭建开发框架，这个开发框架来组织各个中间件，对于web应用的各种基础功能，通过中间件来完成，每个中间件处理掉相对简单的逻辑，最后汇聚成强大的基础框架。<br>由于node的异步执行，需要提供一种机制，在当前中间件处理完成后，通知下一个中间件执行。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//并不是为每一个路由都进行中间件的配置,将路由和中间件结合起来.</span></div><div class="line"><span class="comment">//改进use适应新的参数</span></div><div class="line">app.use = <span class="function"><span class="keyword">function</span>(<span class="params">path</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> handle;</div><div class="line">    <span class="keyword">if</span>(<span class="keyword">typeof</span> path === <span class="string">'string'</span>)&#123;</div><div class="line">        handle = &#123;</div><div class="line">            <span class="comment">//第一个参数作为路径</span></div><div class="line">            path: pathRegexp(path),</div><div class="line">            <span class="comment">//其他的都是处理单元</span></div><div class="line">            stack: <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">1</span>);</div><div class="line">        &#125;;</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">       handle = &#123;</div><div class="line">            <span class="comment">//第一个参数作为路径</span></div><div class="line">            path: pathRegexp(<span class="string">'/'</span>),</div><div class="line">            <span class="comment">//其他的都是处理单元</span></div><div class="line">            stack: <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">0</span>);</div><div class="line">            &#125;;</div><div class="line">         &#125;</div><div class="line">    routes.all.push(handle);</div><div class="line">&#125;;</div><div class="line"><span class="comment">//改进匹配过程</span></div><div class="line"><span class="keyword">var</span> match = <span class="function"><span class="keyword">function</span>(<span class="params">pathname,routes</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> stacks = [];</div><div class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;routes.length; i++)&#123;</div><div class="line">        <span class="keyword">var</span> route = routes[i];</div><div class="line">        <span class="comment">//正则匹配</span></div><div class="line">        <span class="keyword">var</span> reg = route.path.regexp;</div><div class="line">        <span class="keyword">var</span> matched = reg.exec(pathname);</div><div class="line">        <span class="keyword">if</span>(method)&#123;</div><div class="line">            <span class="comment">//抽取具体值</span></div><div class="line">            <span class="comment">//代码省略</span></div><div class="line">            <span class="comment">//将中间件都保存起来</span></div><div class="line">            stacks =stack.concat(route.stack)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">return</span> stacks;</div><div class="line">&#125;;</div><div class="line"><span class="comment">//匹配成功以后交由handle处理</span></div><div class="line"><span class="keyword">var</span> handle = <span class="function"><span class="keyword">function</span>(<span class="params">req, res, stack</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> next = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="comment">//从stack中取出中间件并执行</span></div><div class="line">        <span class="keyword">var</span> middleware = stack.shift();</div><div class="line">        <span class="keyword">if</span>(middleware)&#123;</div><div class="line">            <span class="comment">//传入next()函数自身，是中间件能够执行结束后递归</span></div><div class="line">            middleware(req, res, next);</div><div class="line">        &#125; </div><div class="line">    &#125;;</div><div class="line">    <span class="comment">//启动执行</span></div><div class="line">    next();</div><div class="line">&#125;;</div><div class="line"><span class="comment">//改进分发过程</span></div><div class="line"><span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> pathname = url.parse(req.url).pathname;</div><div class="line">    <span class="keyword">var</span> method = req.method.toLowerCase();</div><div class="line">    <span class="keyword">var</span> stacks = match(pathname, routes.all);</div><div class="line">    <span class="keyword">if</span>(routes.hasOwnPerperty(method))&#123;</div><div class="line">        stacks.concat(match(pathname,routes[method]));</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">if</span>(stacks.length)&#123;</div><div class="line">        handle(req, res, stacks);</div><div class="line">    &#125;<span class="keyword">else</span>&#123;</div><div class="line">        handle404(req,res);</div><div class="line">    &#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h1 id="中间件的异常处理"><a href="#中间件的异常处理" class="headerlink" title="中间件的异常处理"></a>中间件的异常处理</h1><p>中间件具体调动的过程中如果出现了错误，这个时候就需要为next()方法添加参数，来捕获中间件直接抛出的异常<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//异常处理函数handle</span></div><div class="line"><span class="keyword">var</span> handle = <span class="function"><span class="keyword">function</span>(<span class="params">req, res, stack</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> next = <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(err)&#123;</div><div class="line">            <span class="keyword">return</span> handle500(err, req, res, stack);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//从stack中取出中间件并执行</span></div><div class="line">        <span class="keyword">var</span> middleware = stack.shift();</div><div class="line">        <span class="keyword">if</span>(middleware)&#123;</div><div class="line">            <span class="comment">//传入next()函数自身，是中间件能够执行结束后递归</span></div><div class="line">            <span class="keyword">try</span>&#123;</div><div class="line">            middleware(req, res, next);</div><div class="line">            &#125; <span class="keyword">catch</span> (ex) &#123;</div><div class="line">                next(err);</div><div class="line">            &#125;</div><div class="line">         &#125; </div><div class="line">    &#125;;</div><div class="line">    <span class="comment">//启动执行</span></div><div class="line">    next();</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//中间件异步产生的异常需要自己传递出来</span></div><div class="line"><span class="keyword">var</span> session = <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> id = req.cookies.sessionid;</div><div class="line">    store.get(id, <span class="function"><span class="keyword">function</span>(<span class="params">err,session</span>)</span>&#123;</div><div class="line">        <span class="keyword">if</span>(err)&#123;</div><div class="line">            <span class="comment">//将异常通过next()传递</span></div><div class="line">            <span class="keyword">return</span> next(err);</div><div class="line">        &#125;</div><div class="line">        req.session = session;</div><div class="line">        next();</div><div class="line">    &#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//对中间件按参数进行选取</span></div><div class="line"><span class="keyword">var</span> handle500 = <span class="function"><span class="keyword">function</span>(<span class="params">err, req, res, stack</span>)</span>&#123;</div><div class="line">    <span class="comment">//选取异常处理中间件</span></div><div class="line">    stack = stack.filter(<span class="function"><span class="keyword">function</span>(<span class="params">middleware</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> middleware.length === <span class="number">4</span>;</div><div class="line">    &#125;);</div><div class="line">    <span class="keyword">var</span> next = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> middleware = stack.shift();</div><div class="line">        <span class="keyword">if</span>(middleware)&#123;</div><div class="line">            middleware(err, req, res, next)</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    next();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h1 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h1><p>cookie记录的是浏览器和服务器状态的，且可以在前后端进行更改，因此很容易被篡改和伪造，Cookie对于敏感数据保护是无效的。这是session应用而生。<br>session是保留在服务器端。具体的实现方式是 基于Cookie来实现用户和数据的映射<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> writeHead = res.writeHead;</div><div class="line"><span class="keyword">var</span> val = sign(req.sessionID,secret);</div><div class="line">res.writeHead = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> cookies = res.getHeader(<span class="string">'Set-Cookie'</span>);</div><div class="line">	<span class="keyword">var</span> session = serialize(key,req.session.id);</div><div class="line">	cookies = <span class="built_in">Array</span>.isArry(cookies) ? cookies.concat(session):[cookies, session];</div><div class="line">	res.setHeader(<span class="string">'Set-Cookie'</span>, cookie.serialize(key,val));</div><div class="line">	<span class="comment">//save session</span></div><div class="line">	store.save(req,session)</div><div class="line">	<span class="keyword">return</span> writeHead.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//receive request then   check signature</span></div><div class="line"><span class="keyword">var</span> unsign = <span class="function"><span class="keyword">function</span> (<span class="params">val, secret</span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> str = val.slice(<span class="number">0</span>, val.lastIndexOf(<span class="string">'.'</span>));</div><div class="line">	<span class="keyword">return</span> sign(str, secret) == val ? str : <span class="literal">false</span>;</div><div class="line">&#125;;</div><div class="line"><span class="comment">//for example</span></div><div class="line"><span class="keyword">var</span> handle = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">	<span class="keyword">if</span>(!req.session.isVisit)&#123;</div><div class="line">		req.session.isVisit = <span class="literal">true</span>;</div><div class="line">		res.writeHead(<span class="number">200</span>);</div><div class="line">		res.end(<span class="string">'欢迎第一次来动物园'</span>);</div><div class="line">	&#125;<span class="keyword">else</span> &#123;</div><div class="line">		res.writeHead(<span class="number">200</span>);</div><div class="line">		res.end(<span class="string">'欢迎第二次来动物园'</span>);</div><div class="line">	&#125;</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<h1 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h1><p>缓存机制是用来处理在应用中不变的内容，也就是静态资源的缓存，那么如何缓存呢？以及清除缓存？<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//cache with expires or cache-control</span></div><div class="line"><span class="keyword">var</span> handle = <span class="function"><span class="keyword">function</span>(<span class="params">res, req</span>)</span>&#123;</div><div class="line">	fs.stat(filename, <span class="function"><span class="keyword">function</span>(<span class="params">err, stat</span>)</span>&#123;</div><div class="line">		<span class="keyword">var</span> lastModified = stat.mtime.toUTCString();</div><div class="line">		<span class="keyword">if</span>(lastModified === req.headers[<span class="string">'if-modified-since'</span>])&#123;</div><div class="line">			res.writeHead(<span class="number">304</span>, <span class="string">'Not Modified'</span>);</div><div class="line">			res.end();</div><div class="line">		&#125; <span class="keyword">else</span> &#123;</div><div class="line">			fs.readFile(filename, <span class="function"><span class="keyword">function</span>(<span class="params">err, file</span>)</span>&#123;</div><div class="line">				<span class="keyword">var</span> lastModified = stat.mtime.toUTCString();</div><div class="line">				res.setHeader(<span class="string">'Last-Modified'</span>, lastModified);</div><div class="line">				res.writeHead(<span class="number">200</span>, <span class="string">'ok'</span>);</div><div class="line">				res.end(file);</div><div class="line">			&#125;);</div><div class="line">		&#125;</div><div class="line">	&#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//cache with ETags</span></div><div class="line"><span class="keyword">var</span> handle = <span class="function"><span class="keyword">function</span>(<span class="params">str</span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> shaum = ctypto.createHash(<span class="string">'sha1'</span>);</div><div class="line">	<span class="keyword">return</span> shaum.update(str).digest(<span class="string">'base64'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> handle = <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">	fs.readFile(filename, <span class="function"><span class="keyword">function</span>(<span class="params">err, file</span>)</span>&#123;</div><div class="line">		<span class="keyword">var</span> hash = getHash(file);</div><div class="line">		<span class="keyword">var</span> noneMatch = req.headers[<span class="string">'if-none-match'</span>];</div><div class="line">		<span class="keyword">if</span>(hash === noneMatch)&#123;</div><div class="line">			res.writeHead(<span class="number">304</span>, <span class="string">'Not Modified'</span>);</div><div class="line">			res.end();</div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">			res.setHeader(<span class="string">'ETags'</span>, hash);</div><div class="line">			res.writeHead(<span class="number">200</span>,<span class="string">'ok'</span>);</div><div class="line">			res.end(file);</div><div class="line">		&#125;</div><div class="line">	&#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//set cache immediate</span></div><div class="line"><span class="keyword">var</span> handle =  <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">	fs.readFile(filename, <span class="function"><span class="keyword">function</span>(<span class="params">err, file</span>)</span>&#123;</div><div class="line">		res.setHeader(<span class="string">'Cache-Control'</span>,<span class="string">'max-age='</span> + <span class="number">10</span> *<span class="number">365</span> * <span class="number">24</span> * <span class="number">60</span> *<span class="number">60</span>*<span class="number">1000</span>);</div><div class="line">		res.writeHead(<span class="number">200</span>, <span class="string">'ok'</span>);</div><div class="line">		res.end(file);</div><div class="line">	&#125;);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>一般采取的清除缓存的方式是根据文件内容的hash值进行缓存淘汰。</p>
<h1 id="数据上传"><a href="#数据上传" class="headerlink" title="数据上传"></a>数据上传</h1><p>请求方法，路径解析，查询字符串，Cookie，Session，缓存以及Basic认证这些内容，基本都集中在HTTP的请求报文头中，使用与GET和大部分请求，已经可以完成大部分的业务逻辑操作了。但是例如表单提交，文件提交，JSON上传，XML上传等就需要额外的处理方法：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//通过报头中transfer-encoding/content-length来判断是是否带有内容。</span></div><div class="line"><span class="keyword">var</span> hasBody = <span class="function"><span class="keyword">function</span>(<span class="params">req</span>)</span>&#123;</div><div class="line">	<span class="keyword">return</span> <span class="string">'transfer-encoding'</span> <span class="keyword">in</span> req.headers || <span class="string">'content-length'</span> <span class="keyword">in</span> req.headers;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">	<span class="keyword">if</span>(hasBody(req))&#123;</div><div class="line">		<span class="keyword">var</span> buffers = [];</div><div class="line">		req.on(<span class="string">'data'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>)</span>&#123;</div><div class="line">			buffers.push(chunk);</div><div class="line">		&#125;);</div><div class="line">		req.on(<span class="string">'end'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">			req.rawBody = Buffer.concat(buffers).toString();</div><div class="line">			handle(req,res);</div><div class="line">		&#125;);</div><div class="line">	&#125;<span class="keyword">else</span>&#123;</div><div class="line">		handle(req, res);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//handle the database in req.body</span></div><div class="line"><span class="keyword">var</span> handle = <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">	<span class="keyword">if</span>(req.headers[<span class="string">'content-type'</span>] === <span class="string">'application/x-www-form-urlencoded'</span>)&#123;</div><div class="line">		req.body = querystring.parse(req.rawBody);</div><div class="line">	&#125;</div><div class="line">	todo(req,res);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//handle the json </span></div><div class="line"><span class="keyword">var</span> mine = <span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> str = req.headers[<span class="string">'content-type'</span>] || <span class="string">''</span>;</div><div class="line">	<span class="keyword">return</span> str.split(<span class="string">';'</span>)[<span class="number">0</span>];</div><div class="line">&#125;;</div><div class="line"><span class="keyword">var</span> handle = <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">	<span class="keyword">if</span>(mine(req) === <span class="string">'application/json'</span>)&#123;</div><div class="line">		<span class="keyword">try</span>&#123;</div><div class="line">			req.body = <span class="built_in">JSON</span>.parse(req.rawBody);</div><div class="line">		&#125;<span class="keyword">catch</span>(e)&#123;</div><div class="line">			res.writeHead(<span class="number">400</span>);</div><div class="line">			res.end(<span class="string">'Invalid JSON'</span>);</div><div class="line">			<span class="keyword">return</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	todo(req,res);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//handle XML xml2js is a module.</span></div><div class="line"><span class="keyword">var</span> xml2js = <span class="built_in">require</span>(<span class="string">'xml2js'</span>);</div><div class="line"><span class="keyword">var</span> handle = <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">	<span class="keyword">if</span>(mine(req) === <span class="string">'application/xml'</span>)&#123;</div><div class="line">		xml2js.parseString(req.rawBody, <span class="function"><span class="keyword">function</span>(<span class="params">err, xml</span>)</span>&#123;</div><div class="line">			<span class="keyword">if</span>(err)&#123;</div><div class="line">				res.writeHead(<span class="number">400</span>);</div><div class="line">				res.end(<span class="string">'Invalid XML'</span>);</div><div class="line">				<span class="keyword">return</span>;</div><div class="line">			&#125;</div><div class="line">			req.body = xml;</div><div class="line">			todo(req, res);</div><div class="line">		&#125;);</div><div class="line">	&#125;</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="comment">//the way of waterfall  to handle  tables and contents</span></div><div class="line"><span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>)</span>&#123;</div><div class="line">	<span class="keyword">if</span>(hasBody(req))&#123;</div><div class="line">		<span class="keyword">var</span> done = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">			handle(req, res);</div><div class="line">		&#125;;</div><div class="line">		<span class="keyword">if</span>(mine(req) === <span class="string">'application/json'</span>)&#123;</div><div class="line">			parseJSON(req, done);</div><div class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(mine(req) === <span class="string">'application/xml'</span>)&#123;</div><div class="line">			parseXML(req, done);</div><div class="line">		&#125;<span class="keyword">else</span> <span class="keyword">if</span>(mine(req) === <span class="string">'multipart/form-data'</span>)&#123;</div><div class="line">			parseMultipart(req, done);</div><div class="line">		&#125;</div><div class="line">	&#125;<span class="keyword">else</span> &#123;</div><div class="line">		handle(req, res);</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//this is a module of waterfall handle :formidable</span></div><div class="line"><span class="keyword">var</span> formidable = <span class="built_in">require</span>(<span class="string">'formidable'</span>);</div><div class="line"><span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">	<span class="keyword">if</span>(hasBody(req))&#123;</div><div class="line">		<span class="keyword">if</span>(mine(req) === <span class="string">'multipart/form-data'</span>)&#123;</div><div class="line">			<span class="keyword">var</span> form = <span class="keyword">new</span> formidable.IncomingForm();</div><div class="line">			form.parse(req, <span class="function"><span class="keyword">function</span>(<span class="params">err, fields, files</span>)</span>&#123;</div><div class="line">				req.body = fields;</div><div class="line">				req.files = files;</div><div class="line">				handle(req, res);</div><div class="line">			&#125;);</div><div class="line">		&#125;<span class="keyword">else</span>&#123;</div><div class="line">			handle(req, res);</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="comment">//Connect about limit of upload filesize </span></div><div class="line"><span class="keyword">var</span> bytes = <span class="number">1024</span>;</div><div class="line"><span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> received = <span class="number">0</span>;</div><div class="line">	<span class="keyword">var</span> len = req.headers[<span class="string">'content-length'</span>] ? <span class="built_in">parseInt</span>(req.headers[<span class="string">'content-length'</span>], <span class="number">10</span>) : <span class="literal">null</span>;</div><div class="line">	<span class="keyword">if</span>(len &amp;&amp; len &gt; bytes)&#123;</div><div class="line">		res.writeHead(<span class="number">413</span>);</div><div class="line">		res.end();</div><div class="line">		<span class="keyword">return</span>;</div><div class="line">	&#125;</div><div class="line">	<span class="comment">//limit</span></div><div class="line">	req.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>)</span>&#123;</div><div class="line">		received += chunk.length;</div><div class="line">		<span class="keyword">if</span>(received &gt; bytes)&#123;</div><div class="line">			req.destroy();</div><div class="line">		&#125;</div><div class="line">	&#125;);</div><div class="line">	handle(req, res);</div><div class="line">&#125;;</div></pre></td></tr></table></figure></p>
<p>#路径解析(MVC)<br>mvc模型的主要思想是将业务逻辑按职责分离<br>控制器（Controller）一组行为的集合<br>模型（Model）数据相关的操作和封装<br>试图（View）试图的渲染<br>具体流行为：路径解析根据url寻找到对应的控制器行为，行为调用相关的模型，进行数据操作。后调用试图和相关数据进行页面渲染，输出到客户端。<br>那么如何根据url做路由的映射呢？<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//mapping of router from url</span></div><div class="line">exports.setting = <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> routes = [];</div><div class="line">	<span class="keyword">var</span> use = <span class="function"><span class="keyword">function</span>(<span class="params">path, action</span>)</span>&#123;</div><div class="line">		routes.push([pathRegexp(path), action]);</div><div class="line">	&#125;;</div><div class="line">&#125;</div><div class="line"></div><div class="line">		<span class="comment">//RegExp</span></div><div class="line"><span class="keyword">var</span> pathRegexp = <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">		<span class="keyword">var</span> key = [];</div><div class="line">		path = path</div><div class="line">		.concat(strict ? <span class="string">''</span>: <span class="string">'/?'</span>)</div><div class="line">		.replace(<span class="regexp">/\/\(/g</span>,<span class="string">'(?:/)'</span>)</div><div class="line">		.replace(<span class="regexp">/(\/)?(\.)?:(\w+)(?:(\(.*?\)))?(\?)?(\*)?/g</span>), <span class="function"><span class="keyword">function</span>(<span class="params">_,slash, format,key,capture,optionl,star</span>)</span>&#123;</div><div class="line">		keys.push(key);</div><div class="line">		slash = slash || <span class="string">''</span>;</div><div class="line">		<span class="keyword">return</span> <span class="string">''</span></div><div class="line">			+(optionl ? <span class="string">''</span> :slash)</div><div class="line">			+<span class="string">'(?:'</span></div><div class="line">			+(optionl ? slash : <span class="string">''</span>)</div><div class="line">			+(format || <span class="string">''</span>) + (capture || (format &amp;&amp; <span class="string">'([^/.]+?)'</span> || <span class="string">'([^/]+?)'</span>)) + <span class="string">')'</span></div><div class="line">			+(optionl || <span class="string">''</span>)</div><div class="line">			+(star ? <span class="string">'(/*)?'</span> : <span class="string">''</span>);</div><div class="line">			&#125;</div><div class="line">		.replace(<span class="regexp">/([\/.])/g</span>,<span class="string">'\\$1'</span>)</div><div class="line">		.replace(<span class="regexp">/\*/g</span>,<span class="string">'(.*)'</span>);</div><div class="line">	<span class="keyword">return</span> &#123;</div><div class="line">		<span class="attr">keys</span> :keys,</div><div class="line">		<span class="attr">regexp</span> :<span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">'^'</span> + path + <span class="string">'$'</span>)</div><div class="line">			&#125;;</div><div class="line">		&#125;;</div><div class="line"></div><div class="line"></div><div class="line"><span class="comment">//get real value and set req.params</span></div><div class="line"><span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">	<span class="keyword">var</span> pathname = url.parse(req, url).pathname;</div><div class="line">	<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt; routes.length; i++)&#123;</div><div class="line">		<span class="keyword">var</span> route = routes[i];</div><div class="line">		<span class="keyword">var</span> reg = route[<span class="number">0</span>].regexp;</div><div class="line">		<span class="keyword">var</span> keys = route[<span class="number">0</span>].keys;</div><div class="line">		<span class="keyword">var</span> matched = reg.exec(pathname);</div><div class="line">		<span class="keyword">if</span>(matched)&#123;</div><div class="line">			<span class="keyword">var</span> params =&#123;&#125;;</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>, l=keys.length; i&lt;<span class="number">1</span>; i++)&#123;</div><div class="line">				<span class="keyword">var</span> value = matched[i+<span class="number">1</span>];</div><div class="line">				<span class="keyword">if</span>(value)&#123;</div><div class="line">					params[keys[i]] = value;</div><div class="line">				&#125;</div><div class="line">			&#125;</div><div class="line">			req.params = params;</div><div class="line">			<span class="keyword">var</span> action = route[<span class="number">1</span>];</div><div class="line">			action(req,res);</div><div class="line">			<span class="keyword">return</span>;</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	handle404(req, res);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://ycomer.com/2017/08/28/厉害的jQuery之Ajax/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="浪子膏">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="董方园网络blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="董方园网络blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/28/厉害的jQuery之Ajax/" itemprop="url">
                  厉害的jQuery之Ajax
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-28T12:11:03Z">
                2017-08-28
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          
             <span id="/2017/08/28/厉害的jQuery之Ajax/" class="leancloud_visitors" data-flag-title="厉害的jQuery之Ajax">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="jQuery与Ajax"><a href="#jQuery与Ajax" class="headerlink" title="jQuery与Ajax"></a>jQuery与Ajax</h1><p>1.load()从服务器获取静态的数据文件<br>load(url [, data] [,callback])<br>url: 字符串 请求html页面的url地址（若是函数的话，它是事件处理程序注册方法）<br>url(‘url selector’)选择url中的一部分内容是显示<br>data: 对象 发送至服务器的key/value数据<br>根据有没有参数来决定传递方式，没有参数则是GET，有参数则POST。<br>callback: 函数 请求完成时的回调函数，无论请求成功或失败。<br>callback(responseText:请求返回内容, textStatus:请求返回状态(success、error、notmodified、timeout、parsererror), XMLHttpRequset)<br>2.$.get()和$.post()传递一些参数给服务器中的页面，都是使用GET和POST方式进行异步请求。<br>①$.get/$.post(url [, data] [, callback] [, type])<br>url: 字符串 请求html页的url地址<br>data: 对象 发送至服务器的key/value数据会作为QueryString附加到请求url中。<br>callback: 函数 载入成功时回调函数(只有response的返回状态是success才调用改函数)自动将请求结果和状态返回给该方法。<br>type: 字符串 服务器返回内容的格式，包括xml、html、script、json、text、jsonp<br>②区别：</p>
<ul>
<li>get的请求会跟在url后进行传递。post请求则是作为http消息的实体内容发送给web服务器。</li>
<li>get方式对传输的数据大小有限制，而使用post方式传递的参数两要比get大很多</li>
<li>get请求的数据会被浏览器缓存起来，带来严重的安全问题</li>
<li>两种方式传递的数据在服务器端的获取也不同。</li>
</ul>
<p>3.$.ajax()最底层的ajax实现方法，能实现上述三个方式都能实现的功能。<br>  $.ajax(options)<br>  options: url、type、timeout、data、dataType、beforeSend、complete、success、error、global、contentType、cache、ifModified、content。<br> 而且还可以设定<br>  <em>beforeSend(提交前回调函数)
  </em>error(请求失败后处理)<br>  <em>success(请求成功还能处理)
  </em>complete(请求完成后处理)</p>
<p>4.$.getScript()和$.getJson()<br>①$.getScript()直接加载.js文件，他也有回调函数，在函数成功载入后执行。他适用于同源和跨源脚本。在同源情况下，回调函数的第一个参数是脚本的文本内容，第二个是’success’状态码。第三个参数则是用来获取脚本内容的XMLHttpRequest对象。对于跨域不存XMLHttpRequest对象<br>②$.getJSON()用于加载json文件，方法和上面一样。<br>它将获取到的内容解析为JSON，并且只有在传入了回调函数才会有用，如果url或数据字符串在末尾或’&amp;’字符钱含有’=?’字符串，表明这是一个jsonp请求。</p>
<ul>
<li>$.each()函数不同于jquery中的each()方法。不操作jquery对象。而是以一个数组或者对象作为第一个参数，以一个回调函数作为第二个参数。回调函数拥有两个参数，第一个参数为对象的成员或数组的索引， 第二个为对应的变量或内容。 </li>
<li>还可以获取其他网站的json数据。</li>
</ul>
<p>5.序列化元素<br>1.serialize()方法将dom元素内容序列化为字符串，用于ajax请求。它还可以解决字符编码的问题，不仅限于处理表单。<br>2.serializeArray()方法将dom元素序列化以后返回json格式的数据。然后通过使用$.each()函数的数据对象进行迭代输出。<br>3.$.param()用来对一个数组或对象按照key/value进行序列化。<br>6.全局事件<br>ajaxStop(callback)<br>ajaxStart(callback)<br>ajaxComplete(callback)<br>ajaxError(callback)<br>ajaxSend(callback)<br>ajaxSuccess(callback)<br>如果不想触发全局事件则可以设置global:false!</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://ycomer.com/2017/08/25/立即执行函数表达式/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="浪子膏">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="董方园网络blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="董方园网络blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/25/立即执行函数表达式/" itemprop="url">
                  立即执行函数表达式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-25T13:05:50Z">
                2017-08-25
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          
             <span id="/2017/08/25/立即执行函数表达式/" class="leancloud_visitors" data-flag-title="立即执行函数表达式">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一、函数声明</p>
<p>最标准的函数声明是-关键字function后面紧跟着函数名doSomething然后是圆括号()和花括号{}(ps:重要特征就是函数声明提升)<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">doSomething</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="comment">// _...do something...</span></div><div class="line">_&#125;;</div></pre></td></tr></table></figure></p>
<p>二、函数表达式(匿名函数、拉姆达函数)<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> doSomething = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="comment">// _...do something...</span></div><div class="line">_&#125;;</div></pre></td></tr></table></figure></p>
<p>ps:当JavaScript解析器遇到 function关键字时，它通常假设我们在写函数声明，适合用来定义那些只会用到一次的函数。</p>
<p>三、立即执行函数表达式<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="comment">// _...do something...</span></div><div class="line">_&#125;)();</div></pre></td></tr></table></figure></p>
<p>第一个圆括号的作用：<br>通过使用圆括号包裹我们的函数, 我们告诉解释器以函数表达式的方式解析JavaScript代码 , 而不是函数声明。 这样我们的代码在编译的时候不会出现任何错误。<br>第二个圆括号的作用<br>圆括号的作用之一就是用于调用函数。<br>通过在函数表达式后面加上一对圆括号，那么就会立即调用我们的立即执行函数表达式（IIFE）</p>
<p>1.为什么我们要使用 IIFE?<br>私有性.<br>在 JavaScript 中, 变量所在的作用域在包含他们的函数中.这意味着他们不能从函数外被访问<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> superSecret = <span class="number">195</span>;</div><div class="line">&#125;)()</div><div class="line"><span class="built_in">console</span>.log(superSecret);</div><div class="line"><span class="comment">// Uncaught ReferenceError: superSecret is not defined</span></div></pre></td></tr></table></figure></p>
<p>我们不能在 IIFE 之外访问到superSecret。 在 IIFE 内的所有代码都处在该函数的私有的作用域当中。 这允许我们在函数私有的变量和数据不被侵扰的情况下使用这些变量和数据</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://ycomer.com/2017/08/25/执行上下文/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="浪子膏">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="董方园网络blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="董方园网络blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/25/执行上下文/" itemprop="url">
                  执行上下文
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-25T12:36:10Z">
                2017-08-25
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          
             <span id="/2017/08/25/执行上下文/" class="leancloud_visitors" data-flag-title="执行上下文">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>一、当JavaScript代码在运行的时候, 它所在的执行环境是非常重要的, 通常认为是以下其中之一:</p>
<ul>
<li>Global code – 默认环境，你的代码首次执行的地方。</li>
<li>Function code – 当代码执行进入到函数体当中。</li>
<li>Eval code – 在 eval 函数内部执行的文本。<br>二、关于执行上下文有五个要点是要记住的:<br>1.单线程。<br>2.同步执行。<br>3.只有一个全局上下文。<br>4.可有无数个函数上下文。<br>5.每个函数调用都会创建一个新的 执行上下文，哪怕是递归调用。<br>三、执行上下文中的细节<br>①创建阶段 [当函数被调用, 但内部的代码还没开始执行]:<br>②创建作用域链.<br>③创建变量、函数以及参数<br>④决定 “this”的值<br>⑤激活 / 代码执行阶段:<br>⑥赋值, 寻找函数引用以及解释 /执行代码<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">executionContextObj = &#123;</div><div class="line">    <span class="string">'scopeChain'</span>: &#123; <span class="comment">/* 变量对象 + 所有父级执行上下文中的变量对象 */</span> &#125;,</div><div class="line">    <span class="string">'variableObject'</span>: &#123; <span class="comment">/* 函数参数 / 参数, 内部变量以及函数声明 */</span> &#125;,</div><div class="line">    <span class="string">'this'</span>: &#123;&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>这是解释器执行代码时的伪概述:<br>1.寻找调用函数的代码<br>2.在执行函数代码之前,创建执行上下文.<br>3.进入创建阶段:<br>4.初始化作用域链.<br>5.创建变量对象：<br>6.创建参数对象,检查参数的上下文,初始化其名称和值并创建一个引用拷贝。<br>7.扫描上下文中的函数声明：<br>8.对于每个被发现的函数,在变量对象中创建一个和函数名同名的属性这是函数在内存中的引用。<br>9.如果函数名已经存在,引用值将会被覆盖。<br>10.扫描上下文中的变量声明：<br>11.对于每个被发现的变量声明,在变量对象中创建一个同名属性并初始化值为undefined。<br>12.如果变量名在变量对象中已经存在,什么都不做继续扫描。<br>13.确定上下文中的 “this”<br>14.激活/代码执行阶段：<br>15.执行/在上下文中解释函数代码，并在代码逐行执行时给变量赋值。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">i</span>) </span>&#123;</div><div class="line">    <span class="keyword">var</span> a = <span class="string">'hello'</span>;</div><div class="line">    <span class="keyword">var</span> b = <span class="function"><span class="keyword">function</span> <span class="title">privateB</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    &#125;;</div><div class="line">    <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line">foo(<span class="number">22</span>);</div></pre></td></tr></table></figure></p>
<p>创建阶段<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">fooExecutionContext = &#123;</div><div class="line">    <span class="attr">scopeChain</span>: &#123; ... &#125;,</div><div class="line">    <span class="attr">variableObject</span>: &#123;</div><div class="line">        <span class="attr">arguments</span>: &#123;</div><div class="line">            <span class="number">0</span>: <span class="number">22</span>,</div><div class="line">            <span class="attr">length</span>: <span class="number">1</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">i</span>: <span class="number">22</span>,</div><div class="line">        <span class="attr">c</span>: pointer to <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span></div><div class="line">        <span class="title">a</span>: <span class="title">undefined</span>,</div><div class="line">        <span class="title">b</span>: <span class="title">undefined</span></div><div class="line">    &#125;,</div><div class="line">    <span class="title">this</span>: &#123; ... &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>激活/执行阶段<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">fooExecutionContext = &#123;</div><div class="line">    <span class="attr">scopeChain</span>: &#123; ... &#125;,</div><div class="line">    <span class="attr">variableObject</span>: &#123;</div><div class="line">        <span class="attr">arguments</span>: &#123;</div><div class="line">            <span class="number">0</span>: <span class="number">22</span>,</div><div class="line">            <span class="attr">length</span>: <span class="number">1</span></div><div class="line">        &#125;,</div><div class="line">        <span class="attr">i</span>: <span class="number">22</span>,</div><div class="line">        <span class="attr">c</span>: pointer to <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span></div><div class="line">        <span class="title">a</span>: '<span class="title">hello</span>',</div><div class="line">        <span class="title">b</span>: <span class="title">pointer</span> <span class="title">to</span> <span class="title">function</span> <span class="title">privateB</span>(<span class="params"></span>)</div><div class="line">    &#125;,</div><div class="line">    <span class="title">this</span>: &#123; ... &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://ycomer.com/2017/08/24/jQuery-源码解读/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="浪子膏">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="董方园网络blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="董方园网络blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/24/jQuery-源码解读/" itemprop="url">
                  jQuery 源码解读
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-23T23:51:03Z">
                2017-08-23
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          
             <span id="/2017/08/24/jQuery-源码解读/" class="leancloud_visitors" data-flag-title="jQuery 源码解读">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="jquery主体源码阅读"><a href="#jquery主体源码阅读" class="headerlink" title="jquery主体源码阅读"></a>jquery主体源码阅读</h1>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://ycomer.com/2017/08/24/深入浅出ES6之let和const/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="浪子膏">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="董方园网络blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="董方园网络blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/24/深入浅出ES6之let和const/" itemprop="url">
                  深入浅出ES6之let和const
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-23T23:49:37Z">
                2017-08-23
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          
             <span id="/2017/08/24/深入浅出ES6之let和const/" class="leancloud_visitors" data-flag-title="深入浅出ES6之let和const">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ES6"><a href="#ES6" class="headerlink" title="ES6"></a>ES6</h1><h3 id="let和const"><a href="#let和const" class="headerlink" title="let和const"></a>let和const</h3><p>①let<br>只在其代码块内有效<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> a=[];</div><div class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;<span class="number">10</span>; i++)&#123;</div><div class="line">    a[i] = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(i)</div><div class="line">    &#125;;</div><div class="line">&#125;</div><div class="line">a[<span class="number">6</span>]();</div><div class="line"><span class="comment">//6</span></div></pre></td></tr></table></figure></p>
<p>②与for循坏搭配最佳哦<br>for循坏里面的let是父级作用域，里面是块级作用域。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>; i&lt;<span class="number">3</span>; i++)&#123;</div><div class="line">    <span class="keyword">let</span> i=<span class="string">'abc'</span>;</div><div class="line">    <span class="built_in">console</span>.log(i);</div><div class="line">&#125;</div><div class="line"><span class="comment">//3个abc</span></div></pre></td></tr></table></figure></p>
<p>③不存在变量提升<br>必须在声明以后才能使用。未声明的变量在var是undefined。</p>
<p>④暂时性死区（TDZ）<br>let和const都会绑定其所在区块。<br>暂时性死区内typeof不是一个安全的选择。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> x = x;</div><div class="line"><span class="comment">//不报错</span></div><div class="line"><span class="keyword">let</span> x = x;</div><div class="line"><span class="comment">//报错</span></div></pre></td></tr></table></figure></p>
<blockquote>
<p>暂时性死区的本质就是，只要一进入当前作用域，所要使用的变量就已经存在了，但是不可获取，只有等到声明变量的那一行代码出现，才可以获取和使用该变量。</p>
</blockquote>
<p>⑤不允许重复声明<br>在块级作用域呢不允许重复声明变量。</p>
<h3 id="块级作用域"><a href="#块级作用域" class="headerlink" title="块级作用域"></a>块级作用域</h3><p>ES5只有全局作用域和函数作用域，没有块级作用域。let为JS增加了块级作用域。作为立即执行函数表达式（IIFE）的替代。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// IIFE 写法</span></div><div class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> tmp = ...;</div><div class="line">  ...</div><div class="line">&#125;());</div><div class="line"></div><div class="line"><span class="comment">// 块级作用域写法</span></div><div class="line">&#123;</div><div class="line">  <span class="keyword">let</span> tmp = ...;</div><div class="line">  ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>①块级作用域和函数声明<br>ES5规定，函数只能在顶层作用域和函数作用域之中声明，不能在块级作用域声明。<br>ES6引入了块级作用域，明确允许在块级作用域之中声明函数。ES6 规定，块级作用域之中，函数声明语句的行为类似于let，在块级作用域之外不可引用。<br>根据坏境导致的行为应该应该避免在块级作用域内声明函数。如果确实需要，也应该写成函数表达式，而不是函数声明语句。<br>但是块级作用域没有返回值。目前的解决方案是啥？</p>
<h3 id="const"><a href="#const" class="headerlink" title="const"></a>const</h3><p>声明一个只读的常量。一旦声明，常量的值就不能改变。只在块级作用域中有效<br>①本质<br>实际上保证的，并不是变量的值不得改动，而是变量指向的那个内存地址不得改动。对于简单类型的数据（数值、字符串、布尔值），值就保存在变量指向的那个内存地址，因此等同于常量。但对于复合类型的数据（主要是对象和数组），变量指向的内存地址，保存的只是一个指针，const只能保证这个指针是固定的，至于它指向的数据结构是不是可变的，就完全不能控制了。因此，将一个对象声明为常量必须非常小心。<br>可以使用<code>Object.freeze</code>来冻结对象和其属性</p>
<h3 id="声明变量的方法"><a href="#声明变量的方法" class="headerlink" title="声明变量的方法"></a>声明变量的方法</h3><p>①var<br>②function<br>③let<br>④const<br>⑤import<br>⑥class</p>
<h3 id="顶层对象和global对象"><a href="#顶层对象和global对象" class="headerlink" title="顶层对象和global对象"></a>顶层对象和global对象</h3><p>顶层对象，在浏览器环境指的是window对象，在Node指的是global对象。<br>ES6规定：<br>var命令和function命令声明的全局变量，依旧是顶层对象的属性<br>let命令、const命令、class命令声明的全局变量，不属于顶层对象的属性</p>
<h3 id="let和const那些不知道的事情"><a href="#let和const那些不知道的事情" class="headerlink" title="let和const那些不知道的事情"></a>let和const那些不知道的事情</h3>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://ycomer.com/2017/08/24/厉害的jQuery/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="浪子膏">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="董方园网络blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="董方园网络blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/24/厉害的jQuery/" itemprop="url">
                  厉害的jQuery
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-23T23:49:37Z">
                2017-08-23
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          
             <span id="/2017/08/24/厉害的jQuery/" class="leancloud_visitors" data-flag-title="厉害的jQuery">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="jQuery"><a href="#jQuery" class="headerlink" title="jQuery"></a>jQuery</h1><h3 id="选择器"><a href="#选择器" class="headerlink" title="选择器"></a>选择器</h3><p>1.基本选择器</p>
<blockquote>
<p>#id<br>.class<br>.element<br>\.<em><br>.selector1, selector2,···selectorN<br>2.层次选择器<br>$(“ancestor descendant”)<br>$(“parent&gt;child”)<br>$(“prev + next”)<br>$(“prev ~ siblings”)<br>3.过滤选择器<br>1.基本选择器。<br>:first<br>:last<br>:not<br>:even<br>:odd<br>:eq(index) index从0开始<br>:gt(index)<br>:lt(index)<br>:header<br>:animated<br>:focus<br>2.内容过滤选择器<br>:contains(text)<br>:empty<br>:has(selector)<br>:parent<br>3.可见性过滤选择器<br>:hidden<br>:visible<br>4.属性过滤选择器<br>[attribute]<br>[attribute=value]<br>[attribute!=value]<br>[attribute^=value]<br>[attribute$=value]<br>[attribute</em>=value]<br>[attribute|=value]<br>[attribute~=value]<br>[attribute1][attribute2][attributeN]<br>5.子元素过滤选择器<br>:nth-child(index/even/odd/equation) index从1开始<br>:first-child<br>:last-child<br>:only-child<br>6.表单对象属性过滤选择器<br>:enabled<br>:disabled<br>:checked<br>:selected<br>4.表单选择器<br>:input<br>:text<br>:password<br>:radio<br>:checkbox<br>:submit<br>:image<br>:reset<br>:button<br>:file<br>:hidden</p>
</blockquote>
<h3 id="DOM操作"><a href="#DOM操作" class="headerlink" title="DOM操作"></a>DOM操作</h3><h4 id="节点操作"><a href="#节点操作" class="headerlink" title="节点操作"></a>节点操作</h4><p>5.插入节点的方法</p>
<blockquote>
<p>append()追加内容<br>appendTo()追加到指定元素中 颠倒常规顺序<br>prepend()内部前置内容<br>prependTo()前置到指定内容<br>after()之后插入内容<br>insertAfter()插入指定元素后面 颠倒常规用法<br>before()之前插入内容<br>insertBefore() 插入指定元素前面</p>
</blockquote>
<p>6.删除节点</p>
<blockquote>
<p>remove()<br>该节点所包含的所有后代节点都被删除，此方法返回值是一个指向已被删除的的节点的引用，意思后面还可以继续使用，这里就很强大了比如使用appendTo。而且可以有选择行的删除。给remove传递参数即可。<br>detach()<br>和remove一样但是不会把匹配的元素从jquery对象中删除，后面可以继续使用这些匹配的元素。区别就是所有绑定的事件和，附加的数据都会保留下来。<br>empty()<br>清空元素中的所有后代节点。</p>
</blockquote>
<p>7.复制节点</p>
<blockquote>
<p>clone()<br>点击复制一个新元素，但是这个新元素不具有任何功能，这里clone有一个参数true，这个参数能使复制的元素具备被复制元素一样的功能。</p>
</blockquote>
<p>8.替换的节点</p>
<blockquote>
<p>replaceWith()<br>replaceAll()<br>两种替换方法都将所有匹配的元素替换成指定的html或者dom元素，替换后原先绑定的事件都会消失，区别是操作颠倒。</p>
</blockquote>
<p>9.包裹节点</p>
<blockquote>
<p>wrap()<br>将某个节点其他标记包裹起来（所有元素进行单独的包裹）<br>wrapAll()<br>所有匹配的元素用一个元素来包裹，<br>wraInner()<br>所有匹配元素的子内容被包裹起来。</p>
</blockquote>
<h4 id="属性操作"><a href="#属性操作" class="headerlink" title="属性操作"></a>属性操作</h4><p>1.获取和设置属性(getter setter)</p>
<blockquote>
<p>attr()<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$(<span class="string">'p'</span>).attr(&#123;<span class="string">'title'</span>: <span class="string">'your titile'</span>, <span class="string">'name'</span>: <span class="string">'test'</span>&#125;);</div></pre></td></tr></table></figure></p>
</blockquote>
<p>2.删除属性</p>
<blockquote>
<p>removeAttr()<br>3.1.6以后新增方法<br>prop()<br>removeProp()</p>
</blockquote>
<h4 id="样式操作"><a href="#样式操作" class="headerlink" title="样式操作"></a>样式操作</h4><p>1.获取和设置样式</p>
<blockquote>
<p>attr()获取和设置<br>addClass()追加属性<br>2.移除样式<br>removeClass() 删除全部或指定的class 可以给其传递参数也可以不用传递。<br>3.切换样式<br>toggle()控制行为上的重复切换<br>toggleClass()控制样式上的重复切换<br>4.判断是否含有某个样式<br>hasClass()<br>.is()</p>
<h4 id="设置获取HTML、文本和值"><a href="#设置获取HTML、文本和值" class="headerlink" title="设置获取HTML、文本和值"></a>设置获取HTML、文本和值</h4><p>1.html() 用于xhtml 不能用于xml<br>2.text()<br>3.获取元素的值<br>val()和attr()有些时候功能一样。<br>val不仅能获取元素的值也能设置元素的值，第二个就是它能选中选框。<br>defaultValue</p>
</blockquote>
<h4 id="遍历节点"><a href="#遍历节点" class="headerlink" title="遍历节点"></a>遍历节点</h4><p>1.children()<br>匹配子元素集合<br>2.next()<br>匹配元素后面紧邻的同辈元素<br>3.prev()<br>匹配元素前面紧邻的同辈元素<br>4.siblings()<br>匹配元素前后所有的同辈元素<br>5.closest()<br>取得最近的匹配元素，如果没有就逐级向上查找。<br>6.区别<br>parent()获得集合中每个匹配元素父级元素<br>parents()获得集合中每个匹配元素祖先元素<br>closest()元素本身开始逐级向上，并返回最先匹配的祖先元素<br>7.find() filter() nextAll() prevAll()</p>
<h4 id="CSS-DOM"><a href="#CSS-DOM" class="headerlink" title="CSS-DOM"></a>CSS-DOM</h4><p>1.css()<br>获取元素的样式属性，设置单个或多个样式。<br>2.透明度的设置opacity() 和诸如height就可以直接进行设置。<br>.height() .width()<br>3.元素定位</p>
<blockquote>
<p>offset()获取元素在当前视窗的相对偏移量。对可见元素有两个返回值top left<br>position() 获取元素相对于最近一个position样式属性为relative 或absolute的祖父节点的相对偏移量。<br>scrollTop() 获取元素的滚动条距离顶端的距离和距离左侧的距离。<br>scrollLeft()</p>
<h3 id="事件和动画"><a href="#事件和动画" class="headerlink" title="事件和动画"></a>事件和动画</h3><h4 id="事件"><a href="#事件" class="headerlink" title="事件"></a>事件</h4><p>1.$(document).ready()和window.onload的区别<br>①window.onload是在页面全部元素加载完毕以后。而$(document).ready()则是DOM加载完毕以后。<br>②每次调用$(document).ready()都会在先有的行为上追加新的行为，这些行为会根据函数注册的顺序执行。<br>③三种方式均可<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">$(<span class="built_in">document</span>).ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">//</span></div><div class="line">&#125;)</div><div class="line">$(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">//</span></div><div class="line">&#125;)</div><div class="line">$().ready(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="comment">//</span></div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
</blockquote>
<p>2.事件绑定</p>
<blockquote>
<p>bind( type [, data] ,fn);<br>第一个参数表示事件类型：foucs blur load resize srcoll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error<br>第二个参数为可选参数，第三个参数则是用来绑定的处理函数。<br>绑定事件以后要对绑定的事件进行加强，比如通过if else 这样的语句。或者toggle。<br>改变绑带事件的类型可以采用简写的形式来减少代码量。</p>
</blockquote>
<p>合成事件<br>①hover()模拟光标悬停事件，光标移动到元素上时触发第一个函数，移出当前元素，触发第二个函数<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hover(enter, leave);</div></pre></td></tr></table></figure></p>
<p>hover()方法替代的是bind(‘mouseenter’)和bind(‘mouseleave’) 所以在触发hover的第二个函数时使用trigger(‘mouseleave’).<br>②toggle()模拟鼠标连续点击事件。第一次点击元素，触发指定的第一个函数，以此类推。</p>
<p>事件冒泡<br>定义：IE的事件流叫事件冒泡<br>问题：引起预料之外的效果，必须要对事件的作用范围进行限制<br>事件对象：在jQuery中使用事件对象很简单，只需为函数添加一个函数。<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$('element).bind('click', function(event)&#123;</div><div class="line">  //event:事件对象</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>停止事件冒泡：stopPropagation()<br>组织默认行为：preventDefault()<br>以上两种都可以通过 return false来实现。</p>
<p>事件对象的属性<br>1.event.type 获取事件的类型<br>2.event.preventDefault() 阻止默认的事件行为<br>3.event.stopPropagation() 阻止事件冒泡<br>4.event.target() 获取到触发事件的元素<br>5.event.relatedTarget()获取相关元素<br>6.event.pageX和event.pageY 获取光标相对页面的x和y坐标。<br>7.event.which()在鼠标单击事件中获取到鼠标的左中右键，在键盘事件中获取键盘的按钮。<br>8.event.metaKey()键盘事件中获取ctrl()</p>
<p>移除事件<br>unbind()<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">unbind([type], [data]);</div></pre></td></tr></table></figure></p>
<p>one()为元素绑定处理函数，当处理函数触发一次以后，立即被删除。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">one( type, [data], fn);</div></pre></td></tr></table></figure></p>
<p>off()<br>delegate()<br>undelegate()</p>
<p>模拟操作<br>1.常用模拟<br>trigger()<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">$('#btn').trigger('click);</div><div class="line">$('#btn').click();</div></pre></td></tr></table></figure></p>
<p>2.触发自定义事件<br>trigger()<br>3.传递数据<br>trigger(type, [data])第一个参数是触发的事件类型，第二个参数是要传递给事件处理函数的附加数据，以数组的形式传递。<br>4.执行默认操作<br>trigger()<br>triggerHandler()只触发绑定事件，取消默认操作。</p>
<p>其他用法<br>1.绑定多个事件类型。<br>2.添加事件命名空间，便于管理。<br>3.相同事件名称，不同命名空间执行方法。这里注意使用！匹配所有不包含在命名空间中的click方法。</p>
<h4 id="动画"><a href="#动画" class="headerlink" title="动画"></a>动画</h4><p>1.show()和hide()<br>这两种方法都可以带参数，已达到动画的目的。<br>2.fadeIn()和fadeOut() 只改变元素的不透明度。<br>3.slideUp()和slideDown() 只会改变元素的高度。<br>4.animate()<br>animate(params, speed, callback)<br>5.stop()<br>stop([clearQueue].[gotoEnd])其中的参数都是boolean值<br>立即停止当前正在进行的动画，其中clearQueue是否清空未执行完的动画队列。gotoEnd是否直接将正在执行的动画跳转到末尾。<br>6。判断元素是否处于动画状态<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span>(! $(element).is(<span class="string">':animated'</span>))&#123;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>7.延迟动画<br>delay()<br>8.其他动画方法(专门用于交互的)<br>①toggle(speed, [callback])<br>切换元素的可见状态<br>②slideToggle(speed, [easing], [callback])<br>通过高度的变化来切换匹配元素的可见性<br>③fadeTo(speed, opacity, [callback])<br>把元素的不透明度以渐进的方式调整到指定的值。<br>④fadeToggle(speed, [easing], [callback])<br>通过不透明度变化来切换匹配元素的可见性</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://ycomer.com/2017/08/24/深入浅出ES6之变量解构/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="浪子膏">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="董方园网络blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="董方园网络blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/24/深入浅出ES6之变量解构/" itemprop="url">
                  深入浅出之ES6之变量解构
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-23T23:49:37Z">
                2017-08-23
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          
             <span id="/2017/08/24/深入浅出ES6之变量解构/" class="leancloud_visitors" data-flag-title="深入浅出之ES6之变量解构">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h1><p>ES6允许按照一定模式，从数组和对象中提取值，对变量进行赋值，这被称为解构（Destructuring）。也就是模式匹配。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> [a, b, c] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</div><div class="line"><span class="comment">//左右相等的完全结构</span></div><div class="line"><span class="keyword">let</span> [x, y] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>];</div><div class="line"><span class="comment">//左右不相等的不完全结构</span></div></pre></td></tr></table></figure>
<p>链式结构<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> first, second, all;</div><div class="line">all = [first, second] = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>];</div></pre></td></tr></table></figure></p>
<p>嵌套数组<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> [one, [twoA, twoB]] = [<span class="number">1</span>, [<span class="number">2</span>,<span class="number">2.5</span>], <span class="number">3</span>];</div></pre></td></tr></table></figure></p>
<p>解构不成功就返回undefined。如果解构的等号右边不是数组（不可遍历的数据结构）就返回undefined。<br>①默认值<br>解构允许指定默认值<br>一个数组成员不严格等于（===）undefined，默认值是不会生效的。</p>
<h1 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h1><p>数组的元素是按次序排列的，变量的取值由它的位置决定；而对象的属性没有次序，变量必须与属性同名，才能取到正确的值。<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> &#123; <span class="attr">foo</span>: foo, <span class="attr">bar</span>: bar &#125; = &#123; <span class="attr">foo</span>: <span class="string">"aaa"</span>, <span class="attr">bar</span>: <span class="string">"bbb"</span> &#125;;</div></pre></td></tr></table></figure></p>
<p>真正被赋值的是变量</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://ycomer.com/2017/08/24/深入浅出JS之事件/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="浪子膏">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="董方园网络blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="董方园网络blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/24/深入浅出JS之事件/" itemprop="url">
                  深入浅出JS之事件
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-23T23:44:26Z">
                2017-08-23
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          
             <span id="/2017/08/24/深入浅出JS之事件/" class="leancloud_visitors" data-flag-title="深入浅出JS之事件">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="事件类型-event-type"><a href="#事件类型-event-type" class="headerlink" title="事件类型(event type)"></a>事件类型(event type)</h1><p>一、传统事件类型<br>是一个用来说明发生了什么类型事件的字符串。<br>1.表单事件<br>2.window事件<br>3.鼠标事件<br>4.键盘事件<br>二、DOM事件<br>1.html5事件<br>2.触摸屏和移动设备事件</p>
<h1 id="注册事件处理程序"><a href="#注册事件处理程序" class="headerlink" title="注册事件处理程序"></a>注册事件处理程序</h1><p>有两种实现方式<br>1.给事件目标对象或文档元素设置属性<br>2.将事件处理程序传递给对象或者元素一个方法。<br>通用的处理方法是addEventlistener()。<br>事件处理程序属性是在前面加上’on’,并且都是小写。``</p>
<h1 id="事件目标-event-target"><a href="#事件目标-event-target" class="headerlink" title="事件目标(event target"></a>事件目标(event target</h1><p>发生的事件或与之相关的对象。</p>
<h1 id="事件对象-event-object"><a href="#事件对象-event-object" class="headerlink" title="事件对象(event object)"></a>事件对象(event object)</h1><p>与特定事件相关且包含有关该事件详细信息的对象。</p>
<h1 id="事件传播-event-propagation"><a href="#事件传播-event-propagation" class="headerlink" title="事件传播(event propagation)"></a>事件传播(event propagation)</h1><p>是浏览器决定那个对象触发其事件处理程序的过程。它的另一种形式称为事件捕获(event capturing)</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://ycomer.com/2017/08/14/CSS魔法之经典布局/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="浪子膏">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="董方园网络blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="董方园网络blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/14/CSS魔法之经典布局/" itemprop="url">
                  CSS魔法之经典布局
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-08-13T23:48:19Z">
                2017-08-13
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          
             <span id="/2017/08/14/CSS魔法之经典布局/" class="leancloud_visitors" data-flag-title="CSS魔法之经典布局">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="CSS经典布局之圣杯和双飞翼"><a href="#CSS经典布局之圣杯和双飞翼" class="headerlink" title="CSS经典布局之圣杯和双飞翼"></a>CSS经典布局之圣杯和双飞翼</h1><p>圣杯布局与双飞翼布局针对的都是三列左右栏固定中间栏边框自适应的网页布局，下来我们就来实现它。<br>在实现之前我们先来提几个问题？<br>一、浮动产生的问题都有神马?该如何解决？<br>二、实现圣杯布局原理是神马？<br>三、在flexbox和grid中如何实现?<br>带着问题来解决问题。</p>
<h3 id="传统实现"><a href="#传统实现" class="headerlink" title="传统实现"></a>传统实现</h3><p>1.①html代码<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--省略的代码--&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">class</span>=<span class="string">"HolyGrid"</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">header</span>&gt;</span>header<span class="tag">&lt;/<span class="name">header</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"main"</span>&gt;</span>main<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"left"</span>&gt;</span>left<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"right"</span>&gt;</span>right<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">footer</span>&gt;</span>footer<span class="tag">&lt;/<span class="name">footer</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></div><div class="line"><span class="comment">&lt;!-- 省略的代码 --&gt;</span></div></pre></td></tr></table></figure></p>
<p>1.②效果图</p>
<p><div align="center" style="margin-top: 1px;"><br><img src="show1.jpg" alt=""><br></div><br>2.①添加基础样式<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"><span class="selector-tag">header</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">40px</span>;</div><div class="line">    <span class="attribute">background-color</span>: darkseagreen;</div><div class="line">&#125;</div><div class="line"><span class="selector-class">.container</span> &#123;</div><div class="line">    <span class="attribute">background-color</span>: white;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#main</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</div><div class="line">    <span class="attribute">background-color</span>: blue;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#left</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</div><div class="line">    <span class="attribute">background-color</span>: red;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#right</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</div><div class="line">    <span class="attribute">background-color</span>: darkorchid;</div><div class="line">&#125;</div><div class="line"><span class="selector-tag">footer</span> &#123;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">40px</span>;</div><div class="line">    <span class="attribute">background-color</span>: darkgreen;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>2.②效果图</p>
<p><div align="center"><br><img src="show2.png" alt=""><br></div><br>图中我们只是简单的设置了各部分的基础样式，看一开到由于main的宽度设置为了100%所以导致，left和right被挤到下面去了。那么为了实现我们的圣杯布局，这里我们就要用到之前所说的定位和浮动，那么该如何做呢？<br>3.①让容器container里面的元素浮动<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#main</span> &#123;</div><div class="line">    <span class="attribute">float</span>: left;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</div><div class="line">    <span class="attribute">background-color</span>: blue;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#left</span> &#123;</div><div class="line">    <span class="attribute">float</span>: left;</div><div class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</div><div class="line">    <span class="attribute">background-color</span>: red;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#right</span> &#123;</div><div class="line">    <span class="attribute">left</span>: left;</div><div class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</div><div class="line">    <span class="attribute">background-color</span>: darkorchid;</div><div class="line">&#125;</div><div class="line"><span class="selector-tag">footer</span> &#123;</div><div class="line">    <span class="attribute">clear</span>: both;</div><div class="line">    <span class="attribute">width</span>: <span class="number">100%</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">40px</span>;</div><div class="line">    <span class="attribute">background-color</span>: darkgreen;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注：由于在container容器中我们将其所有元素进行了浮动，意味着他们都脱离了文档流，由于footer和header并没有脱离，所以自然的footer就会被main盖住。这里就需要借助clear来清除非浮动块。<br>3.②效果图</p>
<p><div align="center"><br><img src="show3.png" alt=""><br></div><br>4.①达到最终的效果。先上图</p>
<p><div align="center"><br><img src="show4.png" alt=""><br></div><br>图中将left和right浮动块，让其各自margin-left:-100%; margin-left:-200px;代码如下:<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="selector-id">#left</span> &#123;</div><div class="line">    <span class="attribute">margin-left</span>: -<span class="number">100%</span>;</div><div class="line">    <span class="attribute">float</span>: left;</div><div class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</div><div class="line">    <span class="attribute">background-color</span>: red;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-id">#right</span> &#123;</div><div class="line">    <span class="attribute">margin-left</span>: -<span class="number">200px</span>;</div><div class="line">    <span class="attribute">float</span>: left;</div><div class="line">    <span class="attribute">width</span>: <span class="number">200px</span>;</div><div class="line">    <span class="attribute">height</span>: <span class="number">200px</span>;</div><div class="line">    <span class="attribute">background-color</span>: darkorchid;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>关于边距负值的理解和应用大家是必须要了解和掌握的，这里我们已经实现了圣杯布局的整体样式，接下来我们来实现main的自适应。<br>5.①这个时候我们利用内边距padding来实现。将left和right的位置设置为relative。然后就可以固定他们的位置了<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="selector-class">.container</span> &#123;</div><div class="line">    <span class="attribute">padding</span>: <span class="number">0</span> <span class="number">200px</span>;</div><div class="line">    <span class="attribute">overflow</span>: hidden;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#left</span> &#123;</div><div class="line">   <span class="attribute">position</span>: relative;</div><div class="line">   <span class="attribute">left</span>: -<span class="number">200px</span>;</div><div class="line">&#125;</div><div class="line"><span class="selector-id">#right</span> &#123;</div><div class="line">   <span class="attribute">position</span>: relative;</div><div class="line">   <span class="attribute">right</span>: -<span class="number">200px</span>;</div><div class="line">&#125;</div><div class="line">局部代码</div></pre></td></tr></table></figure></p>
<p>5.②效果图</p>
<p><div align="center"><br><img src="show5.png" alt=""><br></div></p>
<h1 id="flex实现"><a href="#flex实现" class="headerlink" title="flex实现"></a>flex实现</h1><p>6.①flex实现相对容易，没有前面那么复杂。也是一种比较好的实现方案。<br><figure class="highlight css"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">  <span class="selector-class">.HolyGrid</span> &#123;</div><div class="line">    <span class="attribute">display</span>: flex;</div><div class="line">    <span class="attribute">min-height</span>: <span class="number">100vh</span>;</div><div class="line">    <span class="attribute">flex-direction</span>: column;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-tag">header</span>,</div><div class="line"><span class="selector-tag">footer</span> &#123;</div><div class="line">    <span class="attribute">background-color</span>: darkgreen;</div><div class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-class">.container</span> &#123;</div><div class="line">    <span class="attribute">display</span>: flex;</div><div class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-id">#main</span> &#123;</div><div class="line">    <span class="attribute">background-color</span>: blue;</div><div class="line">    <span class="attribute">flex</span>: <span class="number">1</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-id">#left</span>,</div><div class="line"><span class="selector-id">#right</span> &#123;</div><div class="line">    <span class="attribute">flex</span>: <span class="number">0</span> <span class="number">0</span> <span class="number">12em</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-id">#right</span> &#123;</div><div class="line">    <span class="attribute">background-color</span>: darkorchid;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="selector-id">#left</span> &#123;</div><div class="line">    <span class="attribute">background-color</span>: red;</div><div class="line">    <span class="attribute">order</span>: -<span class="number">1</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>6.②效果图</p>
<p><div align="center"><br><img src="show6.png" alt=""><br></div></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>圣杯布局和双飞翼布局在main内容之外的思路都是一样的。区别在于main内部内容的显示不一样，具体的是:圣杯布局，为了中间div内容不被遮挡，将中间div设置了左右padding-left和padding-right后，将左右两个div用相对布局position: relative并分别配合right和left属性，以便左右两栏div移动后不遮挡中间div。双飞翼布局，为了中间div内容不被遮挡，直接在中间div内部创建子div用于放置内容，在该子div里用margin-left和margin-right为左右两栏div留出位置。flex实现就更方便了。</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.jpg"
               alt="浪子膏" />
          <p class="site-author-name" itemprop="name">浪子膏</p>
          <p class="site-description motion-element" itemprop="description">一个正在填坑的front-ender</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">60</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">32</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/Ycomer" target="_blank" title="github">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  github
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://twitter.com/Ycnonmer" target="_blank" title="twitter">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  twitter
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://zhihu.com/people/lang-zi-gao-56" target="_blank" title="zhihu">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  zhihu
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">浪子膏</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	




  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("", "");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
